# Unified Rare Disease Data Model
# A harmonized data model for rare disease moglenis databases.

name: rdmodel
label: Rare Diseases Model
description: The Rare Disease Unified Data Model
version: 0.0002
date: 2021-09-07
tags: dcat:catalog


# set tag definitions
tagDefinitions:

  # data object types
  - identifier: dcat:catalog
    label: dcat:Catalog
    objectIRI: https://www.w3.org/TR/vocab-dcat-3/#Class:Catalog
    codeSystem: dcat
    relationLabel: isAssociatedWith
    relationIRI: http://molgenis.org#isAssociatedWith
  - identifier: dcat:dataset
    label: Dataset
    objectIRI: https://www.w3.org/TR/vocab-dcat-3/#Property:catalog_dataset
    codeSystem: dcat
    relationLabel: isAssociatedWith
    relationIRI: http://molgenis.org#isAssociatedWith

    # tag for patients dataset
  - identifier: NCIT:C90492
    label: NCIT:C90492
    objectIRI: http://purl.obolibrary.org/obo/NCIT_C90492
    codeSystem: NCIT
    relationLabel: isAssociatedWith
    relationIRI: http://molgenis.org#isAssociatedWith

# Set default attribute values
defaults:
  idAttribute: false
  dataType: string
  nillable: true
  lookupAttribute: false


# Define tables
entities:

  # TODO: What name should we use to describe individuals?
  # COSAS uses patients and RD3 uses subject
  - name: personal
    label: Personal Information
    description: Information about the individuals and family members
    tags: dcat:dataset,NCIT:C90492
    attributes:
    
      # TODO: What name should we use for personal identifier?
      # Consider the naming structure for family, maternal, paternal, and relatives
      - name: personalID
        name-rd3: subjectID
        name-cosas: umcgID
        dataType: string
        idAttribute: true
        nillable: false
        unique: true
        lookupAttribute: true
        labelAttribute: true
      
      - name: familyID
        name-rd3: fid
        name-cosas: familyID
        dataType: string
      
      # TODO: Should the following attributes reference the personal identifier attribute?
      # I.e., should the dataType be `xref` (or `mref` for more than one)
      - name: maternalID
        name-rd3: mid
        name-cosas: maternalID
      - name: paternalID
        name-cosas: paternalID
        name-rd3: pid
      - name: linkedFamilyIDs
        name-cosas: linkedFamilyIDs
        name-rd3: none

      - name: dateOfBirth
        name-cosas: dateOfBirth # yyyy-mm-dd
        name-rd3: dateOfBirth # year
        dataType: date
      - name: yearOfBirth
        name-cosas: none
        name-rd3: dateOfBirth # year
      - name: dateOfDeath
        name-cosas: dateOfDeath
        name-rd3: none
        dataType: date
      - name: ageAtDeath # years
        name-cosas: ageAtDeath # years
        name-rd3: ageOfDeath
        dataType: integer
      
      # TODO: Integrate FAIR Genomes Lookup table
      - name: inclusionStatus
        name-cosas: inclusionStatus
        dataType: categorical
        refEntity: ...

      - name: claimedSex
        name-cosas: biologicalSex
        name-rd3: sex1
        dataType: categorical
        refEntity: ...
      - name: geneticSex
        name-cosas: biologicalSex
        name-rd3: sex2
        dataType: categorical
        refEntity: ...

      # TODO: include FG modules here: country and ancestry
      - name: countryOfBirth
        name-cosas: none
        name-rd3: Country_of_origin
      - name: countryOfResidence
        name-cosas: none
        name-rd3: none
      - name: ancestry
        name-cosas: none
        name-rd3: none

      # For now, these should be strings. If the networks are ERNS, then we can
      # use the ERN metadata dataset.
      - name: primaryAffiliation
        name-cosas: none
        name-rd3: organisation
      - name: affiliatedNetworks
        name-cosas: none
        name-rd3: ERN

      - name: consanguinity
        name-cosas: consanguinity
        name-rd3: consanguinity_suspected
        dataType: bool

      # TODO: these are included in COSAS and GeneticLines, but I think they
      # removed/no longer used
      - name: fetalStatus
        name-cosas: is_fetus
        name-rd3: none
        dataType: bool
      - name: twinStatus
        name-cosas: is_twin
        name-rd3: none
        dataType: bool

      # The values in this attribute should be comma-separated strings
      - name: altPersonalIDs
        name-cosas: altPatientID
        name-rd3: none

      # TODO: First contact of what? Clinical visit? Contacted by clinic? Is this even needed?
      - name: firstContact
        name-cosas: none
        name-rd3: none
        dataType: date

      # TODO: a high-level consent status may be useful here
      - name: consentStatus
        name-cosas: none
        name-rd3: retracted, matchmaker permission, incidental findings
        dataType: categoricalmref
        refEntity: ...

      # TODO: should we add additional internal attributes here?
      - name: dateLastUpdated
        name-cosas: dateLastUpdated
        name-rd3: none
        dataType: dateTime

  - name: clinical
    attributes:
      - name: personalID
        name-rd3: subjectID
        name-cosas: umcgID
        idAttribute: true
        nillable: false
      - name: clinicalID
        name-cosas: none
        name-rd3: phenopacketsID
      - name: dateOfDiagnosis
        name-cosas: none
        name-rd3: none
        dataType: date
      - name: ageAtDiagnosis
        name-cosas: none
        name-rd3: ageOfDiagnosis
      - name: ageOfOnset
        name-cosas: none
        name-rd3: ageOfOnset
      - name: clinicalDiagnosis
        name-cosas: confirmedPhenotype
        name-rd3: disease
      - name: observedPhenotype
        name-cosas: confirmedPhenotype
        name-rd3: phenotype
      - name: unobservedPhenotype
        name-cosas: excludedPhenotypeHpo # potentially
        name-rd3: hasNotPhenotype
      - name: molecularDiagnosis
        name-cosas: none
        name-rd3: variant
        label: Causal Variant
      - name: solvedStatus
        name-cosas: none
        name-rd3: solved
        dataType: bool
      - name: dateSolved
        name-cosas: none
        name-rd3: date_solved
      - name: dateLastUpdated
        name-cosas: dateLastUpdated
        name-rd3: none
        dataType: dateTime
  - name: samples
    label: Samples
    label-nl: Samples
    description: Sample metadata including tests performed and results
    description-nl: Metagegevens over het monster, inclusief uitgevoerde tests en resultaten
    attributes:
      - name: personalID
        name-rd3: subjectID
        name-cosas: umcgID
        idAttribute: true
        nillable: false
        dataType: string
      - name: sampleID
        name-cosas: sampleID
        name-rd3: sampleID
      - name: alternateID
        name-cosas: requestID
        name-rd3: alternativeIdentifier
      - name: materialID
        name-cosas: dnaID
        name-rd3: none
      - name: samplingDate
        name-cosas: testDate
        name-rd3: none
        dataType: date
      - name: materialType
        name-cosas: materialType
        name-rd3: materialType
        # dataType: xref
        # refEntity: \*_materialTypes
      - name: tissueType
        name-cosas: none
        name-rd3: tissueType
        # dataType: xref
        # refEntity: \*_tissueTypes
      - name: labIndication
        name-cosas: labIndication
        # dataType: xref
        # refEntity: ...
      - name: sampleStatus
        name-cosas: none
        name-rd3: retracted
        # dataType: xref
        # refEntity: ...
      - name: dateLastUpdated
        name-cosas: dateLastUpdated
        name-rd3: none
        dataType: dateTime
  - name: experiments
    attributes:
      - name: personalID
        name-rd3: subjectID
        name-cosas: umcgID
        # idAttribute: true
        # nillable: false
        dataType: string
      - name: sampleID
        name-cosas: sampleID
        name-rd3: sampleID
      - name: materialID
        name-cosas: dnaID
        name-rd3: none
      - name: experimentID
        name-cosas: testCode 
        name-rd3: experimentID
      - name: experimentDate
        name-cosas: testDate
        name-rd3: none
      - name: sequencingCenter
        name-cosas: none
        name-rd3: sequencingCenter
      - name: sequencingPlatform
        name-cosas: none
        name-rd3: sequencer
      - name: sequencingModel
        name-cosas: none
        name-rd3: sequencer
      - name: sequencingType # or sequencingMethod?
        name-cosas: none
        name-rd3: seqType
      - name: prepKit
        name-cosas: none
        name-rd3: none
      - name: enrichmentKit
        name-cosas: none
        name-rd3: capture
      - name: barcode
        name-cosas: none
        name-rd3: barcode
      - name: avgReadDepth
        name-cosas: none
        name-rd3: mean_cov
      - name: percentTR20
        name-cosas: none
        name-rd3: c20
      - name: experimentStatus
        name-cosas: none
        name-rd3: retracted
        # dataType: xref
        # refEntity: ...
      - name: batch
        name-cosas: batch
        name-rd3: none
      - name: genomeBuild
        name-cosas: genomeBuild
        name-rd3: none
      - name: dateLastUpdated
        name-cosas: dateLastUpdated
        name-rd3: none
        dataType: dateTime
  - name: files
    attributes:
      - name: personalID
        name-rd3: subjectID
        name-cosas: umcgID
        # idAttribute: true
        # nillable: false
        dataType: string
      # use one or more of the following three ID variables
      # it depends on what is available/more useful
      - name: sampleID
        name-cosas: sampleID
        name-rd3: sampleID
      - name: experimentID
        name-cosas: testCode  # more likely to be available than test_id
        name-rd3: experimentID
      - name: fileID
        name-cosas: none
        name-rd3: EGA
      - name: filePath
        name-cosas: filepath
        name-rd3: name
      - name: fileType
        name-cosas: filetype
        name-rd3: typeFile
        # dataType: xref
        # refEntity: \*_filetypes
      - name: dateCreated
        name-cosas: created
        name-rd3: dateCreated
      - name: md5
        label: Checksum
        label-nl: Checksum
      - name: dateLastUpdated
        name-cosas: dateLastUpdated
        name-rd3: none
        dataType: dateTime