#//////////////////////////////////////////////////////////////////////////////
# NAME: model_emx_v2.yaml
# AUTHOR: david ruvolo,
# VERSION: 0.0.9000
# CREATED: 2021-10-26
# MODIFIED: 2021-10-26
# PURPOSE: Unified Rare Disease Data Model
# STATUS: in.progress
# COMMENTS:
#//////////////////////////////////////////////////////////////////////////////

tables:

  # @title Persons
  # @description This table provides an overview of the patients and any linked
  #   family members
  # @TODO
  #  - What is an appropriate name for this table?
  #  - What is the appropriate semantic tag?
  - name: persons
    description: Characteristics about an individual and related family members
    semantics: http://purl.obolibrary.org/obo/NCIT_C90492
    columns:
    
      # perhaps this solves of the patients vs subjects discussion?
      - name: belongsToPerson
        key: 1
        required: true
        columnType: string
        description: A unique proper name or character sequence that identifies this particular person.
        semantics: http://purl.obolibrary.org/obo/NCIT_C164337

      # Perhaps a better name could be used here?
      # Should this attribute also be a key?
      - name: belongsToFamily
        required: true
        columnType: string
        description: A domestic group, or a number of domestic groups linked through descent (demonstrated or stipulated) from a common ancestor, marriage, or adoption.
        semantics: http://purl.obolibrary.org/obo/NCIT_C25173
        
      # Should we continue to use the 'belongsTo*' format?
      # This should always be a ref to the same table 
      - name: belongsToMother
        required: false
        columnType: ref
        refTable: persons
        refLabel: "${belongsToPerson}"
        description: A designation that has some relationship to motherhood.
        semantics: http://purl.obolibrary.org/obo/NCIT_C89336
        
      # Should we continue to use the 'belongsTo*' format?
      # This should always be a ref to the same table
      - name: belongsToFather
        required: false
        columnType: ref
        refTable: persons
        refLabel: "${belongsToPerson}"
        description: Having to do with the father, coming from the father, or related through the father.
        semantics: http://purl.obolibrary.org/obo/NCIT_C94324
      
      # How should we name linked family members? I like the 'belongs*' format :-)
      # Should the main definition be used instead? I opted for the alt as it was
      #   a bit more universal.
      #   "A person related by blood or marriage"
      - name: belongsWithFamilyMembers
        required: false
        columnType: ref_array
        refTable: person
        refLabel: "${belongsToPerson}"
        description: Any individual related biologically or legally to another individual.
        semantics: http://purl.obolibrary.org/obo/NCIT_C21480
      
      # Where in the model should inclusionStatus go?
      - name: inclusionStatus
        required: false
        columnType: ref
        refTable: inclusionStatus
        refLabel: "${value}"
        description: An indicator that provides information on the current health status of this person.
        semantics: http://purl.obolibrary.org/obo/NCIT_C166244 
      
      # Should we include both date and year in the model?
      - name: dateOfBirth
        required: false
        columnType: date
        description: The calendar date on which a person was born.
        semantics: http://purl.obolibrary.org/obo/NCIT_C68615
      
      - name: yearOfBirth
        required: false
        columnType: int
        description: The year in which a person was born.
        semantics: http://purl.obolibrary.org/obo/NCIT_C83164
      
      # Date of death does not sit in FairGenomes. Should this be added?
      - name: dateOfDeath
        required: false
        columnType: date
        description: The calendar date of subject's death
        semantics: http://purl.obolibrary.org/obo/NCIT_C70810

      # I'm using decimal for more precise calculations
      - name: ageAtDeath
        required: false
        columnType: decimal
        description: The age at which death occurred.
        semantics: http://purl.obolibrary.org/obo/NCIT_C135383
      
      # I've seen 'biologicalSex' here, but I've opted for the FG term.
      - name: phenotypicSex
        required: false
        columnType: ref
        refTable: phenotypicSex
        refLabel: "${value}"
        description: An organismal quality inhering in a bearer by virtue of the bearer's physical expression of sexual characteristics.
        semantics: http://purl.obolibrary.org/obo/PATO_0001894
        
      # I'm adding genotypicSex in the model, but we usually don't have access to it
      - name: genotypicSex
        required: false
        columnType: ref
        refTable: genotypicSex
        refLabel: "${value}"
        description: A biological sex quality inhering in an individual based upon genotypic composition of sex chromosomes.
        semantics: http://purl.obolibrary.org/obo/PATO_0020000
        
      # I'm adding this, but we normally don't use it.
      - name: countryOfBirth
        required: false
        columnType: ref
        refTable: countries
        refLabel: "${value}"
        description: The country that this person was born in.
        semantics: http://purl.obolibrary.org/obo/GENEPIO_0001094
        
      # I'm adding this, but we normally don't use it
      - name: countryOfResidence
        required: false
        columnType: ref
        refTable: countries
        refLabel: "${value}"
        description: Country of residence at enrollment.
        semantics: http://purl.obolibrary.org/obo/NCIT_C171105
        
      - name: ancestry
        required: false
        columnType: ref
        refTable: ancestry
        refLabel: "${value}"
        description: Population category defined using ancestry informative markers (AIMs) based on genetic/genomic data.
        semantics: http://purl.obolibrary.org/obo/NCIT_C176763
        
      # This isn't in FG, but could be useful
      # Should we use a reference database? Perhaps ROR IDs?
      # Is a string array good or perhaps we could use hyperlinks?
      # In the earlier version of this model, we created the column 'affiliatedNetworks'.
      #   However, we can probably merge that column with this one. If that is the case,
      #   then we may want to consider renaming this column
      - name: primaryAffiliation
        required: false
        columnType: string_array
        description: The most significant institute for medical consultation and/or study inclusion in context of the genetic disease of this person.
        semantics: http://purl.obolibrary.org/obo/NCIT_C25412
        
        
      #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      
      # This is an RD3 specific column
      - name: contactPerson
        required: false
        columnType: string
        description: A person acting as a channel for communication between groups or on behalf of a group.
        semantics: http://purl.obolibrary.org/obo/NCIT_C25461
      #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        
      # Perhaps "secondary identifier" would fit better? http://www.ontobee.org/ontology/NCIT?iri=http://purl.obolibrary.org/obo/NCIT_C101703
      - name: alternativeIdentifiers
        required: false
        columnType: string_array
        description: A unique proper name or character sequence that identifies this particular person.
        semantics: http://purl.obolibrary.org/obo/NCIT_C164337
        
        
      # This isn't in FG, but it is often collected in RD databases
      - name: firstVisitDate
        required: false
        columnType: date
        description: The date for the first patient visit.
        semantics: http://purl.obolibrary.org/obo/NCIT_C164021
        
        
      # should this be moved to samples?
      - name: twinStatus
      - name: consanguinity
      
      #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      # table row metadata
      
      # refers to the datetime when the entry was created in the database
      - name: dateRecordCreated
        required: true
        columnType: datetime
        description: The date on which the activity or entity is created.
        semantics: http://purl.obolibrary.org/obo/NCIT_C164483
      
      # refers to the datetime when the entry was last updated in the database
      - name: dateRecordUpdated
        required: true
        columnType: datetime
        description: The date (and time) on which report was updated after it had been submitted.
        semantics: http://purl.obolibrary.org/obo/NCIT_C93629
      
        
  #////////////////////////////////////
  
  # I'm not sure what to put in this table. I've added the RD3 items, but for care databases,
  # we do not usually collect this information.
  - name: consent
    description: Consent given by a patient to a surgical or medical procedure or participation in a study, examination or analysis after achieving an understanding of the relevant medical facts and the risks involved.
    semantics: http://purl.obolibrary.org/obo/NCIT_C16735
    columns:
      - name: belongsToPerson
        key: 1
        required: true
        
      - name: validFrom
        columnType: date
        description: Starting date of the validity of this individual consent.
        semantics: http://purl.org/dc/terms/valid
      
      - name: validUntil
        columnType: date
        description: End date of the validity of this individual consent.
        semantics: http://purl.org/dc/terms/valid
  
      #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      # RD3 Specific Columns
      
      # see notes about
      - name: primaryAffiliation
        required: false
        columnType: string_array
        description: The most significant institute for medical consultation and/or study inclusion in context of the genetic disease of this person.
        semantics: http://purl.obolibrary.org/obo/NCIT_C25412
         
      # see notes above
      - name: contactPerson
        required: false
        columnType: string
        validation: "if(!/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(value))\
          \ 'Should be valid email address'"
        description: A person acting as a channel for communication between groups or on behalf of a group.
        semantics: http://purl.obolibrary.org/obo/NCIT_C25461
      
      # some how we need to fit in match maker permission and incidental findings
      # Should these be put in a ref_array?
      - name: dataUsePermission
        description: A data item that is used to indicate consent permissions for datasets and/or materials, and relates to the purposes for which datasets and/or material might be used.
        semantics: http://purl.obolibrary.org/obo/DUO_0000001
        
      - name: allowRecontacting
        columnType: bool
        description: The procedure of recontacting the patient for specified reasons. This means the patient agrees to be re-identifiable under those circumstances.
        semantics: http://purl.obolibrary.org/obo/NCIT_C25737
        
      - name: allowIncidentalFindingRecontact
        columnType: bool
        description: A planned process for a subject agrees not to be informed about any incidental finding.
        semantics: http://purl.obolibrary.org/obo/ICO_0000178
        
      - name: allowMatchmaker
        columnType: bool
        description: ...
      
      #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        
        
  
  
  #////////////////////////////////////
  
  # - name: clinical
  #   description: Findings and circumstances relating to the examination and treatment of a patient.
  #   semantics: http://purl.obolibrary.org/obo/NCIT_C25398
  #   columns:
  #     - name: belongsToPerson
  #       key: 1
  #       required: true
  #       columnType: string
  #     - name: person
  #       columnType: string
  #       refTable: patients
  #       refLabel: "${name}"
    
  # - name: material
  #   description: A natural substance derived from living organisms such as cells, tissues, proteins, and DNA.
  #   semantics: http://purl.obolibrary.org/obo/NCIT_C43376
  #   columns:
  #     - name: belongsToSample
  #       key: 1
  #       required: true
        
    
  # - name: samplePreparation
  #   description: A sample preparation for a nucleic acids sequencing assay.
  #   semantics: http://purl.obolibrary.org/obo/OBI_0001902
  #   columns:

  # - name: sequencing
  #   description: The determination of complete (typically nucleotide) sequences, including those of genomes (full genome sequencing, de novo sequencing and resequencing), amplicons and transcriptomes.
  #   semantics: http://edamontology.org/topic_3168
  #   columns:
  #     - name: belongsToSample
  #       key: 1
  #       required: true
  #       columnType: string
    
  # - name: files
  #   description: A set of related records (either written or electronic) kept together.
  #   semantics: http://purl.obolibrary.org/obo/NCIT_C42883
  #   columns:
  #     - name: belongsToAnalysis
  #       key: 1
  #       required: true
  #       columnType: string
      